<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hypothesis Testing Visualizer</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>

    <style>
        body { background: #f8fafc; }
        .card {
            background: white;
            border-radius: 1rem;
            padding: 1.25rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
    </style>
</head>

<body class="flex justify-center px-4 py-6">
<div id="root" class="w-full max-w-[480px]"></div>

<script type="text/babel">

/* ---------------------------------------------------------
   FIX: MOBILE KaTeX LOADING ISSUE
--------------------------------------------------------- */
window.katexLoaded = false;

// When KaTeX script finishes
document.addEventListener("DOMContentLoaded", () => {
    if (window.katex) window.katexLoaded = true;
});

// Explicit <script> load detection
const katexScript = document.querySelector('script[src*="katex"]');
if (katexScript) {
    katexScript.addEventListener("load", () => { window.katexLoaded = true; });
}

/* ---------------------------------------------------------
   LATEX COMPONENT — FIXED VERSION
--------------------------------------------------------- */
const Latex = ({ children, displayMode = false, className = "" }) => {
    const containerRef = React.useRef(null);

    const renderLatex = () => {
        if (window.katexLoaded && containerRef.current) {
            try {
                window.katex.render(children, containerRef.current, {
                    throwOnError: false,
                    displayMode,
                });
            } catch (e) {
                console.error("KaTeX error:", e);
                containerRef.current.textContent = children;
            }
        }
    };

    React.useEffect(() => {
        if (window.katexLoaded) {
            renderLatex();
        } else {
            const timer = setInterval(() => {
                if (window.katexLoaded) {
                    renderLatex();
                    clearInterval(timer);
                }
            }, 90);
        }
    }, [children, displayMode]);

    return <span ref={containerRef} className={className}></span>;
};


/* ---------------------------------------------------------
   MAIN APP
--------------------------------------------------------- */
const App = () => {
    return (
        <div className="flex flex-col gap-6">

            {/* Header */}
            <div className="text-center">
                <h1 className="text-3xl font-extrabold text-slate-800">Hypothesis Testing</h1>
                <p className="text-slate-500 mt-1 text-sm">
                    Visual intuition for z-tests and rejection regions.
                </p>
            </div>

            {/* Notes Card */}
            <div className="card">
                <h2 className="text-lg font-bold text-slate-800 mb-3">Key Idea</h2>

                <p className="text-sm leading-relaxed text-slate-700">
                    We test a population mean by comparing the standardized statistic:
                </p>

                <div className="text-center my-3 text-lg">
                    <Latex displayMode={true}>{String.raw`\displaystyle z = \frac{\bar{x} - \mu_0}{\sigma / \sqrt{n}}`}</Latex>
                </div>

                <p className="text-sm text-slate-700">
                    If $z$ falls in the rejection region, we reject $H_0$.
                </p>
            </div>

            {/* Example Card */}
            <div className="card">
                <h2 className="text-lg font-bold text-slate-800 mb-3">Example</h2>

                <p className="text-sm text-slate-700">Suppose:</p>
                <ul className="text-sm text-slate-700 list-disc ml-6 mt-2">
                    <li>Claim: <Latex>{`H_0: \\mu = 50`}</Latex></li>
                    <li>Sample mean: <Latex>{`\\bar{x} = 53`}</Latex></li>
                    <li>Known σ = 10, Sample size n = 36</li>
                </ul>

                <div className="mt-3 text-center text-lg">
                    <Latex displayMode={true}>
                        {String.raw`\displaystyle z = \frac{53 - 50}{10/\sqrt{36}} = 1.8`}
                    </Latex>
                </div>

                <p className="text-sm text-slate-700 mt-2">
                    For a two-tailed test at 5%, critical values are ±1.96.
                </p>

                <p className="text-sm font-semibold text-blue-700 mt-1">
                    → 1.8 does NOT fall in the rejection region → Fail to reject $H_0$.
                </p>
            </div>

            {/* Footer */}
            <footer class="py-6">
                <div class="flex justify-center">
                    <div class="bg-white border border-slate-300 rounded-full px-5 py-2 shadow-sm flex items-center gap-3 hover:shadow-md transition">
                        <img src="https://img.calcgospel.top/PicList/202512/c9ba5099657621ce60b55f0cfb0e7457.png"
                             class="w-6 h-6 rounded-full" />
                        <span class="text-xs text-slate-600 tracking-wide">
                            微积分福音 · Hypothesis Testing Visualizer
                        </span>
                    </div>
                </div>
            </footer>

        </div>
    );
};


/* Render App */
ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>

</body>
</html>
