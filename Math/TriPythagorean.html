<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三角恒等式复习工具</title>
    
    <!-- 引入 React, ReactDOM, Babel (用于解析 JSX) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入 Tailwind CSS (用于样式) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* 引入 Google Fonts (改为 SC 简体中文) */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Noto+Serif+SC:wght@500;700&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        
        /* 翻转卡片效果相关样式 */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* 答错时的震动动画 */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .animate-shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 内嵌 SVG 图示组件 ---
        const Icons = {
            BookOpen: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            HelpCircle: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>,
            Trophy: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
            RotateCcw: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Check: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            X: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Calculator: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            ChevronRight: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            ChevronLeft: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            Home: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        };

        const { BookOpen, HelpCircle, Trophy, RotateCcw, Check, X, Calculator, ChevronRight, ChevronLeft, Home } = Icons;

        // --- 资料设定 ---
        const identityData = [
            {
                id: 1,
                main: ["sin²θ", "+", "cos²θ", "=", "1"],
                hint: "最基本的恒等式，来自单位圆上 x² + y² = 1",
                variations: ["sin²θ = 1 - cos²θ", "cos²θ = 1 - sin²θ"],
                color: "bg-blue-100 border-blue-300 text-blue-800"
            },
            {
                id: 2,
                main: ["1", "+", "tan²θ", "=", "sec²θ"],
                hint: "将主恒等式同除以 cos²θ 即可推导出",
                variations: ["tan²θ = sec²θ - 1", "sec²θ - tan²θ = 1"],
                color: "bg-emerald-100 border-emerald-300 text-emerald-800"
            },
            {
                id: 3,
                main: ["1", "+", "cot²θ", "=", "csc²θ"],
                hint: "将主恒等式同除以 sin²θ 即可推导出",
                variations: ["cot²θ = csc²θ - 1", "csc²θ - cot²θ = 1"],
                color: "bg-purple-100 border-purple-300 text-purple-800"
            }
        ];

        // --- 辅助组件 ---

        const MathText = ({ text, className = "" }) => (
            <span className={`font-serif italic font-bold tracking-wider ${className}`}>
                {text}
            </span>
        );

        // --- 子画面组件 ---

        const MenuScreen = ({ onSelectMode }) => (
            <div className="flex flex-col items-center justify-center h-full p-8 space-y-6 animate-[fadeIn_0.5s_ease-out]">
                <div className="w-full max-w-sm space-y-4">
                    <button 
                        onClick={() => onSelectMode('study')}
                        className="w-full p-6 bg-blue-50 hover:bg-blue-100 border-2 border-blue-200 rounded-2xl transition-all flex items-center group shadow-sm hover:shadow-md"
                    >
                        <div className="bg-blue-500 p-3 rounded-xl text-white group-hover:scale-110 transition-transform shadow-blue-200 shadow-lg">
                            <BookOpen size={24} />
                        </div>
                        <div className="ml-5 text-left">
                            <h3 className="text-xl font-bold text-blue-900">学习模式</h3>
                            <p className="text-blue-600/80 text-sm mt-1">浏览公式卡片与推导记忆法</p>
                        </div>
                        <ChevronRight className="ml-auto text-blue-300 group-hover:translate-x-1 transition-transform" />
                    </button>

                    <button 
                        onClick={() => onSelectMode('quiz')}
                        className="w-full p-6 bg-orange-50 hover:bg-orange-100 border-2 border-orange-200 rounded-2xl transition-all flex items-center group shadow-sm hover:shadow-md"
                    >
                        <div className="bg-orange-500 p-3 rounded-xl text-white group-hover:scale-110 transition-transform shadow-orange-200 shadow-lg">
                            <Trophy size={24} />
                        </div>
                        <div className="ml-5 text-left">
                            <h3 className="text-xl font-bold text-orange-900">测验挑战</h3>
                            <p className="text-orange-600/80 text-sm mt-1">填空测验，测试你的记忆力</p>
                        </div>
                        <ChevronRight className="ml-auto text-orange-300 group-hover:translate-x-1 transition-transform" />
                    </button>
                </div>
            </div>
        );

        const StudyScreen = ({ onBack }) => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);

            const nextCard = () => {
                setIsFlipped(false);
                setTimeout(() => setCurrentIndex((prev) => (prev + 1) % identityData.length), 200);
            };

            const prevCard = () => {
                setIsFlipped(false);
                setTimeout(() => setCurrentIndex((prev) => (prev - 1 + identityData.length) % identityData.length), 200);
            };

            const currentItem = identityData[currentIndex];

            return (
                <div className="flex flex-col h-full">
                    {/* Header */}
                    <div className="p-4 border-b flex items-center justify-between bg-gray-50/50">
                        <button onClick={onBack} className="text-gray-500 hover:text-gray-800 flex items-center text-sm font-bold px-2 py-1 rounded hover:bg-gray-200 transition-colors">
                            <ChevronLeft size={18} className="mr-1" /> 返回
                        </button>
                        <span className="font-bold text-gray-400 font-mono">卡片 {currentIndex + 1} / {identityData.length}</span>
                        <div className="w-16"></div>
                    </div>

                    {/* Card Area */}
                    <div className="flex-1 p-6 flex flex-col items-center justify-center relative perspective-1000">
                        <div 
                            className="w-full max-w-sm aspect-[4/3] relative cursor-pointer group"
                            onClick={() => setIsFlipped(!isFlipped)}
                            style={{ perspective: '1000px' }}
                        >
                            <div className={`w-full h-full relative transition-transform duration-500 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}
                                 style={{ transformStyle: 'preserve-3d', transform: isFlipped ? 'rotateY(180deg)' : 'rotateY(0deg)' }}>
                                
                                {/* Front */}
                                <div className={`absolute w-full h-full backface-hidden ${currentItem.color} rounded-2xl border-2 flex flex-col items-center justify-center p-8 shadow-xl`}
                                     style={{ backfaceVisibility: 'hidden' }}>
                                    <div className="text-xs font-bold uppercase tracking-[0.2em] opacity-50 mb-6 bg-white/50 px-3 py-1 rounded-full">Formula</div>
                                    <div className="flex space-x-3 items-center flex-wrap justify-center gap-y-2">
                                        {currentItem.main.map((part, idx) => (
                                            <MathText key={idx} text={part} className="text-3xl md:text-4xl" />
                                        ))}
                                    </div>
                                    <div className="mt-8 text-sm opacity-60 flex items-center animate-pulse">
                                        <RotateCcw size={14} className="mr-1" /> 点击翻转
                                    </div>
                                </div>

                                {/* Back */}
                                <div className="absolute w-full h-full backface-hidden bg-slate-800 text-white rounded-2xl flex flex-col items-center justify-center p-8 text-center shadow-xl rotate-y-180"
                                     style={{ backfaceVisibility: 'hidden', transform: 'rotateY(180deg)' }}>
                                    <div className="text-yellow-400 font-bold mb-4 flex items-center bg-yellow-400/10 px-3 py-1 rounded-full text-sm">
                                        <HelpCircle size={16} className="mr-2" /> 记忆提示
                                    </div>
                                    <p className="mb-6 text-slate-300 leading-relaxed text-lg font-medium">{currentItem.hint}</p>
                                    
                                    <div className="w-full border-t border-slate-700 pt-4">
                                        <div className="text-xs text-slate-500 mb-2 uppercase tracking-wider">变形公式</div>
                                        {currentItem.variations.map((v, i) => (
                                            <div key={i} className="font-serif italic text-emerald-400 my-1 text-lg">{v}</div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="p-6 flex justify-between items-center bg-gray-50 border-t">
                        <button onClick={prevCard} className="p-4 rounded-full bg-white border border-gray-200 hover:bg-gray-100 transition-colors shadow-sm text-gray-600">
                            <ChevronLeft size={24} />
                        </button>
                        <span className="text-sm text-gray-400 font-medium">点击卡片查看提示</span>
                        <button onClick={nextCard} className="p-4 rounded-full bg-white border border-gray-200 hover:bg-gray-100 transition-colors shadow-sm text-gray-600">
                            <ChevronRight size={24} />
                        </button>
                    </div>
                </div>
            );
        };

        const QuizScreen = ({ onBack }) => {
            const [currentQ, setCurrentQ] = useState(null);
            const [options, setOptions] = useState([]);
            const [feedback, setFeedback] = useState(null); // 'correct', 'wrong', null
            const [streak, setStreak] = useState(0);

            const generateQuestion = () => {
                const randomIdentity = identityData[Math.floor(Math.random() * identityData.length)];
                // 隐藏索引 0, 2, 4 (分别对应 A, B, C 在 A + B = C 结构中)
                const validIndices = [0, 2, 4]; 
                const hideIndex = validIndices[Math.floor(Math.random() * validIndices.length)];
                
                const answer = randomIdentity.main[hideIndex];
                
                // 干扰项
                const allTerms = ["sin²θ", "cos²θ", "tan²θ", "sec²θ", "cot²θ", "csc²θ", "1"];
                let distractors = allTerms
                    .filter(t => t !== answer)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3);
                
                const questionData = {
                    ...randomIdentity,
                    hiddenIndex: hideIndex,
                    answer: answer
                };

                const currentOptions = [...distractors, answer].sort(() => 0.5 - Math.random());

                setCurrentQ(questionData);
                setOptions(currentOptions);
                setFeedback(null);
            };

            useEffect(() => {
                generateQuestion();
            }, []);

            const handleAnswer = (selected) => {
                if (feedback) return;

                if (selected === currentQ.answer) {
                    setFeedback('correct');
                    setStreak(s => s + 1);
                    setTimeout(generateQuestion, 1200);
                } else {
                    setFeedback('wrong');
                    setStreak(0);
                }
            };

            if (!currentQ) return <div className="flex items-center justify-center h-full">加载中...</div>;

            return (
                <div className="flex flex-col h-full bg-slate-50">
                    <div className="p-4 border-b bg-white flex items-center justify-between shadow-sm z-10">
                        <button onClick={onBack} className="text-slate-500 hover:text-slate-800 text-sm font-bold flex items-center px-2 py-1 rounded hover:bg-slate-100">
                            <Home size={16} className="mr-1" /> 退出
                        </button>
                        <div className="flex items-center text-orange-600 font-bold bg-orange-50 px-3 py-1 rounded-full border border-orange-100">
                            <Trophy size={16} className="mr-2" />
                            连对: {streak}
                        </div>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center p-6 max-w-lg mx-auto w-full">
                        <div className="text-xs text-slate-400 mb-8 uppercase tracking-[0.2em] font-bold">填空题</div>
                        
                        {/* Question Area */}
                        <div className="bg-white px-6 py-12 rounded-3xl shadow-lg border border-slate-100 mb-8 flex items-center justify-center flex-wrap gap-3 w-full relative overflow-hidden">
                            {/* Background decoration */}
                            <div className={`absolute top-0 left-0 w-full h-1 transition-colors duration-300 ${feedback === 'correct' ? 'bg-green-500' : feedback === 'wrong' ? 'bg-red-500' : 'bg-transparent'}`} />

                            {currentQ.main.map((part, idx) => {
                                if (idx === currentQ.hiddenIndex) {
                                    return (
                                        <div key={idx} className={`
                                            min-w-[80px] h-14 px-4 rounded-xl border-2 border-dashed flex items-center justify-center transition-all duration-300
                                            ${feedback === 'correct' ? 'border-green-500 bg-green-50 text-green-700 scale-110' : 
                                              feedback === 'wrong' ? 'border-red-500 bg-red-50 animate-shake' : 'border-slate-300 bg-slate-50'}
                                        `}>
                                            {feedback === 'correct' ? (
                                                <MathText text={currentQ.answer} className="text-xl" />
                                            ) : (
                                                <span className="text-2xl text-slate-300 font-bold">?</span>
                                            )}
                                        </div>
                                    );
                                }
                                return <MathText key={idx} text={part} className="text-2xl text-slate-700" />;
                            })}
                        </div>

                        {/* Feedback Text */}
                        <div className="h-8 mb-6 flex justify-center">
                            {feedback === 'correct' && (
                                <div className="text-green-600 font-bold flex items-center">
                                    <Check size={20} className="mr-1" /> 正确答案！
                                </div>
                            )}
                            {feedback === 'wrong' && (
                                <div className="text-red-500 font-bold flex items-center">
                                    <X size={20} className="mr-1" /> 哎呀，再试一次！
                                </div>
                            )}
                        </div>

                        {/* Options */}
                        <div className="grid grid-cols-2 gap-4 w-full">
                            {options.map((opt, idx) => (
                                <button
                                    key={idx}
                                    onClick={() => handleAnswer(opt)}
                                    disabled={feedback === 'correct'}
                                    className={`
                                        py-4 px-2 rounded-xl border-2 text-xl font-medium transition-all transform active:scale-[0.98]
                                        font-serif italic relative overflow-hidden
                                        ${feedback === 'correct' && opt === currentQ.answer 
                                            ? 'bg-green-500 border-green-500 text-white shadow-lg shadow-green-200'
                                            : 'bg-white border-slate-200 text-slate-700 hover:border-teal-400 hover:bg-teal-50 hover:shadow-md'}
                                    `}
                                >
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [mode, setMode] = useState('menu'); // 'menu', 'study', 'quiz'

            return (
                <div className="min-h-screen bg-slate-100 flex items-center justify-center font-sans text-slate-800 selection:bg-teal-200 p-2">
                    <div className="w-full h-screen md:h-[650px] md:max-w-[420px] bg-white md:rounded-[2rem] shadow-2xl overflow-hidden flex flex-col relative border-4 border-slate-800/5">
                        
                        {/* 共同顶部 (仅在 Menu 显示大标题，其他模式有自己的 Header) */}
                        {mode === 'menu' && (
                            <header className="pt-12 pb-4 text-center px-8 bg-gradient-to-b from-teal-50/50 to-white">
                                <div className="inline-flex items-center justify-center p-4 bg-teal-600 rounded-2xl shadow-xl shadow-teal-200 mb-6 transform rotate-3 hover:rotate-6 transition-transform">
                                    <Calculator size={32} className="text-white" />
                                </div>
                                <h1 className="text-3xl font-black text-slate-800 mb-2 tracking-tight">三角恒等式大师</h1>
                                <p className="text-slate-500 font-medium">复习与精通 sin, cos, tan 的平方关系</p>
                            </header>
                        )}

                        {/* 主要内容区 */}
                        <main className="flex-1 overflow-hidden relative bg-white">
                            {mode === 'menu' && <MenuScreen onSelectMode={setMode} />}
                            {mode === 'study' && <StudyScreen onBack={() => setMode('menu')} />}
                            {mode === 'quiz' && <QuizScreen onBack={() => setMode('menu')} />}
                        </main>
                        
                        {mode === 'menu' && (
                            <footer className="p-4 text-center flex flex-col items-center justify-center gap-2">
                                <div className="flex items-center gap-2 bg-slate-50/80 px-4 py-2 rounded-full border border-slate-200 shadow-sm">
                                    <img src="https://img.calcgospel.top/PicList/202512/c9ba5099657621ce60b55f0cfb0e7457.png" alt="Logo" className="w-8 h-8 rounded-full border border-slate-200" />
                                    <span className="text-slate-600 font-medium text-sm">微积分福音 卓永鸿老师制作</span>
                                </div>
                            </footer>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>