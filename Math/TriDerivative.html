<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>三角函数导函数复习工具</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- KaTeX -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
  />
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
  ></script>
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
  ></script>

  <style>
    /* 手机端闪卡比例 & 视觉优化 */
    .flashcard {
      width: 100%;
      max-width: 420px;
      aspect-ratio: 3 / 4; /* 与 Gospel 一致 */
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.2rem;
    }

    .formula-box {
      width: 100%;
      background: white;
      padding: 1rem;
      border-radius: 0.75rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    /* 防止 KaTeX 超宽导致页面撑开 */
    .katex-display {
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    /* Action buttons 的触控范围优化 */
    .touch-btn {
      padding: 0.7rem 1.1rem;
      border-radius: 0.75rem;
      font-size: 1rem;
      min-width: 90px;
    }

    /* Tab 按钮在手机上自动换行 */
    .tab-buttons {
      flex-wrap: wrap;
      gap: 0.4rem;
    }

  </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center py-6 px-3">
  <div id="root" class="w-full max-w-xl"></div>

  <!-- React Code -->
  <script type="text/babel">

    //////////////////////////////////////////////////////
    // 原始 React 逻辑完全保留 —— 我没有动内部的结构
    //////////////////////////////////////////////////////

    function App() {
      const [tab, setTab] = React.useState("table");
      const [index, setIndex] = React.useState(0);

      const data = [
        { formula: "\\frac{d}{dx}[\\sin x] = \\cos x" },
        { formula: "\\frac{d}{dx}[\\cos x] = -\\sin x" },
        { formula: "\\frac{d}{dx}[\\tan x] = \\sec^2 x" },
        { formula: "\\frac{d}{dx}[\\cot x] = -\\csc^2 x" },
        { formula: "\\frac{d}{dx}[\\sec x] = \\sec x\\tan x" },
        { formula: "\\frac{d}{dx}[\\csc x] = -\\csc x\\cot x" }
      ];

      // 下一张
      function next() {
        setIndex((index + 1) % data.length);
      }

      // 上一张
      function prev() {
        setIndex((index - 1 + data.length) % data.length);
      }

      React.useEffect(() => {
        renderMathInElement(document.body, {
          delimiters: [
            { left: "\\(", right: "\\)", display: false },
            { left: "\\[", right: "\\]", display: true }
          ]
        });

        // --- 每次渲染后更新 iframe 高度 ---
        setTimeout(() => {
          const h = document.documentElement.scrollHeight;
          window.parent.postMessage({ type: "triderivative-height", height: h }, "*");
        }, 80);

      });

      return (
        <div className="w-full">

          {/* Title */}
          <h1 className="text-2xl font-bold text-center mb-4 text-gray-800">
            三角函数导函数复习工具
          </h1>

          {/* Tab Buttons */}
          <div className="flex tab-buttons justify-center mb-4">
            <button
              className={
                "px-4 py-2 rounded-xl " +
                (tab === "table"
                  ? "bg-blue-600 text-white"
                  : "bg-white border")
              }
              onClick={() => setTab("table")}
            >
              公式表
            </button>

            <button
              className={
                "px-4 py-2 rounded-xl " +
                (tab === "card"
                  ? "bg-blue-600 text-white"
                  : "bg-white border")
              }
              onClick={() => setTab("card")}
            >
              背诵卡
            </button>

            <button
              className={
                "px-4 py-2 rounded-xl " +
                (tab === "quiz"
                  ? "bg-blue-600 text-white"
                  : "bg-white border")
              }
              onClick={() => setTab("quiz")}
            >
              测验
            </button>
          </div>

          {/* ---- TAB 1: 公式表 ---- */}
          {tab === "table" && (
            <div className="space-y-4">
              {data.map((d, i) => (
                <div key={i} className="formula-box">
                  <span className="font-semibold text-gray-700">公式 {i + 1}</span>
                  <div className="mt-2 katex-display">
                    \\[{d.formula}\\]
                  </div>
                </div>
              ))}
            </div>
          )}

          {/* ---- TAB 2: 背诵卡 ---- */}
          {tab === "card" && (
            <div className="flex flex-col items-center space-y-4">
              <div className="flashcard text-center text-xl">
                <span> \\[{data[index].formula}\\] </span>
              </div>

              <div className="flex gap-4">
                <button className="touch-btn bg-gray-200" onClick={prev}>上一张</button>
                <button className="touch-btn bg-blue-600 text-white" onClick={next}>下一张</button>
              </div>
            </div>
          )}

          {/* ---- TAB 3: 测验 ---- */}
          {tab === "quiz" && (
            <div className="space-y-4">
              <div className="formula-box text-center text-lg">
                下面哪个是导函数：<br /><br />
                <span>\\[{data[index].formula}\\]</span>
              </div>

              <div className="flex flex-wrap justify-center gap-3">
                <button className="touch-btn bg-white border">选项 A</button>
                <button className="touch-btn bg-white border">选项 B</button>
                <button className="touch-btn bg-white border">选项 C</button>
                <button className="touch-btn bg-white border">选项 D</button>
              </div>

              <div className="text-center">
                <button
                  onClick={next}
                  className="mt-3 touch-btn bg-blue-600 text-white"
                >
                  下一题
                </button>
              </div>
            </div>
          )}

        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
