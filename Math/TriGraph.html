<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三角函数图像生成器</title>
    <!-- 引入 Tailwind CSS (用于样式) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons (用于图标) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        /* 防止手机端触摸时的意外行为 */
        canvas { touch-action: none; }
        /* 数学公式字体优化 */
        .math-font { font-family: 'Times New Roman', serif; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
        
        <!-- Header -->
        <div class="bg-slate-900 text-white p-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold tracking-tight">三角函数图像生成器</h1>
                <p class="text-slate-400 text-sm mt-1">可视化学习助手 - 观察角度与函数值的变化</p>
            </div>
            <!-- 数学公式显示区域：移除全局 italic，改为内部控制 -->
            <div id="formula-display" class="text-3xl math-font text-blue-400 opacity-90">
                <i>y</i> = sin(<i>x</i>)
            </div>
        </div>

        <!-- Controls -->
        <div class="p-6 bg-slate-50 border-b border-slate-200 flex flex-wrap gap-4 items-center justify-between">
            <div class="flex gap-2">
                <button onclick="setFunc('sin')" id="btn-sin" class="px-6 py-2 rounded-lg font-medium transition-all bg-blue-600 text-white shadow-md shadow-blue-200 scale-105">
                    y = sin x
                </button>
                <button onclick="setFunc('cos')" id="btn-cos" class="px-6 py-2 rounded-lg font-medium transition-all bg-white text-slate-600 hover:bg-slate-100 border border-slate-200">
                    y = cos x
                </button>
                <button onclick="setFunc('tan')" id="btn-tan" class="px-6 py-2 rounded-lg font-medium transition-all bg-white text-slate-600 hover:bg-slate-100 border border-slate-200">
                    y = tan x
                </button>
            </div>

            <div class="flex items-center gap-3 bg-white p-2 rounded-lg border border-slate-200">
                <button onclick="togglePlay()" id="btn-play" class="p-2 rounded-full hover:bg-slate-100 text-slate-700 transition-colors" title="暂停/播放">
                    <i data-lucide="pause" id="icon-play-pause"></i>
                </button>
                <button onclick="replay()" class="p-2 rounded-full hover:bg-slate-100 text-slate-700 transition-colors" title="重播">
                    <i data-lucide="rotate-ccw"></i>
                </button>
                <div class="h-6 w-px bg-slate-200 mx-1"></div>
                <span class="text-xs text-slate-500 font-medium">速度</span>
                <input type="range" min="1" max="10" value="2" oninput="updateSpeed(this.value)" class="w-24 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-900">
            </div>
        </div>

        <!-- Canvas Area -->
        <div class="p-4 overflow-hidden relative" id="canvas-container">
            <canvas id="trigCanvas" class="w-full h-[400px] cursor-crosshair"></canvas>
            <div id="degree-display" class="absolute top-6 right-6 bg-white/90 backdrop-blur-sm p-3 rounded-lg shadow-sm border border-slate-100 text-sm font-mono text-slate-600 pointer-events-none">
                x: -360°
            </div>
        </div>

        <!-- Educational Info Footer -->
        <div class="bg-blue-50 p-6 border-t border-blue-100 flex items-start gap-4">
            <div class="bg-blue-100 p-2 rounded-full text-blue-600 mt-1 shrink-0">
                <i data-lucide="info"></i>
            </div>
            <div>
                <h3 class="font-semibold text-blue-900 mb-1">图像特征学习</h3>
                <p id="desc-display" class="text-blue-800 leading-relaxed">
                    正弦函数 (Sine)：周期为 360°。经过原点 (0,0)，在 90° 达到最大值 1。值域为 [-1, 1]。
                </p>
            </div>
        </div>
    </div>

    <div class="mt-8 text-slate-400 text-xs text-center">
        推荐横屏浏览以获得最佳体验 • 支持触摸操作
    </div>

    <script>
        // --- 状态管理 ---
        const state = {
            funcType: 'sin',
            isAnimating: true,
            animationSpeed: 2,
            progress: -360,
            xMin: -360,
            xMax: 360,
            yLimit: 2.5
        };

        // --- DOM 元素引用 ---
        const canvas = document.getElementById('trigCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvas-container');
        const degreeDisplay = document.getElementById('degree-display');
        const formulaDisplay = document.getElementById('formula-display');
        const descDisplay = document.getElementById('desc-display');
        const playBtnIcon = document.getElementById('icon-play-pause');

        // --- 初始化 ---
        window.addEventListener('load', () => {
            lucide.createIcons();
            resizeCanvas();
            animate();
        });

        window.addEventListener('resize', () => {
            resizeCanvas();
            draw(); // 重绘一帧以防闪烁
        });

        // --- 核心逻辑 ---

        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = 400 * dpr;
            ctx.scale(dpr, dpr);
            // 存储逻辑宽度以供绘图使用
            state.width = rect.width;
            state.height = 400;
        }

        // 映射函数
        function mapX(deg) {
            const range = state.xMax - state.xMin;
            return (deg - state.xMin) / range * state.width;
        }

        function mapY(val) {
            const unitPixels = (state.height / 2) / state.yLimit;
            return (state.height / 2) - (val * unitPixels);
        }

        // 动画循环
        function animate() {
            if (state.isAnimating) {
                state.progress += state.animationSpeed;
                if (state.progress >= state.xMax) {
                    state.progress = state.xMax;
                    state.isAnimating = false;
                    updatePlayButtonIcon();
                }
                degreeDisplay.textContent = `x: ${Math.round(state.progress)}°`;
            }
            
            draw();
            requestAnimationFrame(animate);
        }

        // 绘图主函数
        function draw() {
            const { width, height, xMin, xMax, yLimit, funcType, progress } = state;
            
            // 1. 清空画布
            ctx.clearRect(0, 0, width, height);

            // 2. 网格背景
            ctx.fillStyle = '#f8fafc';
            ctx.fillRect(0, 0, width, height);
            
            ctx.lineWidth = 1;
            ctx.strokeStyle = '#e2e8f0';

            // 垂直网格
            ctx.beginPath();
            for (let d = xMin; d <= xMax; d += 30) {
                const x = mapX(d);
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
            }
            ctx.stroke();

            // 水平网格
            ctx.beginPath();
            for (let v = -Math.floor(yLimit); v <= Math.floor(yLimit); v += 0.5) {
                if (v === 0) continue;
                const y = mapY(v);
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
            }
            ctx.stroke();

            // 3. 辅助线绘制 (渐近线 或 值域边界) - 新增功能
            ctx.save(); // 保存当前状态
            ctx.setLineDash([5, 5]); // 设置虚线
            ctx.lineWidth = 1;

            if (funcType === 'tan') {
                // Tan: 绘制垂直渐近线
                ctx.strokeStyle = '#94a3b8'; // 灰色
                [-270, -90, 90, 270].forEach(deg => {
                    const x = mapX(deg);
                    if (x >= 0 && x <= width) {
                        ctx.beginPath();
                        ctx.moveTo(x, 0);
                        ctx.lineTo(x, height);
                        ctx.stroke();
                    }
                });
            } else {
                // Sin/Cos: 绘制水平值域边界 (y=1, y=-1)
                ctx.strokeStyle = '#cbd5e1'; // 浅灰色
                [1, -1].forEach(val => {
                    const y = mapY(val);
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                });
            }
            ctx.restore(); // 恢复实线状态

            // 4. 坐标轴
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#475569';
            ctx.beginPath();
            const yOrigin = mapY(0);
            ctx.moveTo(0, yOrigin);
            ctx.lineTo(width, yOrigin); // X轴
            
            const xOrigin = mapX(0);
            ctx.moveTo(xOrigin, 0);
            ctx.lineTo(xOrigin, height); // Y轴
            ctx.stroke();

            // 5. 刻度标签
            ctx.fillStyle = '#334155';
            ctx.font = '14px Inter, sans-serif';
            ctx.textAlign = 'center';

            // X轴刻度
            [-360, -270, -180, -90, 0, 90, 180, 270, 360].forEach(deg => {
                const x = mapX(deg);
                ctx.beginPath();
                ctx.moveTo(x, yOrigin - 5);
                ctx.lineTo(x, yOrigin + 5);
                ctx.stroke();
                if (deg !== 0) ctx.fillText(`${deg}°`, x, yOrigin + 20);
            });

            // Y轴刻度
            ctx.textAlign = 'right';
            [-2, -1, 1, 2].forEach(val => {
                const y = mapY(val);
                ctx.beginPath();
                ctx.moveTo(xOrigin - 5, y);
                ctx.lineTo(xOrigin + 5, y);
                ctx.stroke();
                ctx.fillText(val, xOrigin - 8, y + 5);
            });
            ctx.fillText("0", xOrigin - 8, yOrigin + 20);

            // 6. 绘制函数曲线
            ctx.lineWidth = 3;
            if (funcType === 'sin') ctx.strokeStyle = '#3b82f6';
            else if (funcType === 'cos') ctx.strokeStyle = '#10b981';
            else if (funcType === 'tan') ctx.strokeStyle = '#f59e0b';

            ctx.beginPath();
            let firstPoint = true;

            for (let d = xMin; d <= progress; d += 1) {
                const rad = (d * Math.PI) / 180;
                let val = 0;
                if (funcType === 'sin') val = Math.sin(rad);
                else if (funcType === 'cos') val = Math.cos(rad);
                else if (funcType === 'tan') val = Math.tan(rad);

                // Tan 函数断点处理
                if (funcType === 'tan' && Math.abs(val) > yLimit * 1.5) {
                    firstPoint = true;
                    continue;
                }

                const px = mapX(d);
                const py = mapY(val);

                if (firstPoint) {
                    ctx.moveTo(px, py);
                    firstPoint = false;
                } else {
                    ctx.lineTo(px, py);
                }
            }
            ctx.stroke();

            // 7. 绘制笔头圆点
            const currentRad = (progress * Math.PI) / 180;
            let currentVal = 0;
            if (funcType === 'sin') currentVal = Math.sin(currentRad);
            else if (funcType === 'cos') currentVal = Math.cos(currentRad);
            else if (funcType === 'tan') currentVal = Math.tan(currentRad);

            if (Math.abs(currentVal) < yLimit * 1.5) {
                const tracerX = mapX(progress);
                const tracerY = mapY(currentVal);
                
                ctx.fillStyle = ctx.strokeStyle;
                ctx.beginPath();
                ctx.arc(tracerX, tracerY, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(tracerX, tracerY, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // --- 控制函数 ---

        function setFunc(type) {
            state.funcType = type;
            state.progress = state.xMin;
            state.isAnimating = true;
            updatePlayButtonIcon();
            updateUI();
        }

        function togglePlay() {
            state.isAnimating = !state.isAnimating;
            // 如果已经结束了，点击播放应该重置
            if (state.isAnimating && state.progress >= state.xMax) {
                state.progress = state.xMin;
            }
            updatePlayButtonIcon();
        }

        function replay() {
            state.progress = state.xMin;
            state.isAnimating = true;
            updatePlayButtonIcon();
        }

        function updateSpeed(val) {
            state.animationSpeed = Number(val);
        }

        function updatePlayButtonIcon() {
            playBtnIcon.setAttribute('data-lucide', state.isAnimating ? 'pause' : 'play');
            lucide.createIcons(); 
        }

        function updateUI() {
            // 更新按钮样式
            const buttons = {
                'sin': document.getElementById('btn-sin'),
                'cos': document.getElementById('btn-cos'),
                'tan': document.getElementById('btn-tan')
            };
            
            // 重置所有按钮
            Object.values(buttons).forEach(btn => {
                btn.className = "px-6 py-2 rounded-lg font-medium transition-all bg-white text-slate-600 hover:bg-slate-100 border border-slate-200";
            });

            // 高亮当前按钮
            const activeBtn = buttons[state.funcType];
            let activeClass = "px-6 py-2 rounded-lg font-medium transition-all text-white shadow-md scale-105 ";
            if (state.funcType === 'sin') activeClass += "bg-blue-600 shadow-blue-200";
            if (state.funcType === 'cos') activeClass += "bg-emerald-600 shadow-emerald-200";
            if (state.funcType === 'tan') activeClass += "bg-amber-500 shadow-amber-200";
            activeBtn.className = activeClass;

            // 更新文本与公式（注意：这里使用了 innerHTML 来支持 HTML 标签）
            if (state.funcType === 'sin') {
                formulaDisplay.innerHTML = "<i>y</i> = sin(<i>x</i>)";
                descDisplay.innerText = "正弦函数 (Sine)：周期为 360°。值域为 [-1, 1]。经过原点 (0,0)，在 90° 达到最大值 1。";
            } else if (state.funcType === 'cos') {
                formulaDisplay.innerHTML = "<i>y</i> = cos(<i>x</i>)";
                descDisplay.innerText = "余弦函数 (Cosine)：周期为 360°。值域为 [-1, 1]。在 0° 时为最大值 1，图像仿佛是正弦函数左移了 90°。";
            } else if (state.funcType === 'tan') {
                formulaDisplay.innerHTML = "<i>y</i> = tan(<i>x</i>)";
                descDisplay.innerText = "正切函数 (Tangent)：周期为 180°。在 -90° 和 90° 处存在垂直渐近线（已用虚线标出），函数值趋向无穷大。";
            }
        }

    </script>
</body>
</html>