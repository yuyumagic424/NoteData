<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta
        name="viewport"
        content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"
    >
    <title>《耶稣所传的福音》 第一部 闪卡复习</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* 基本 reset，避免在 iframe 中出现奇怪间距 */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #9cceec; /* slate-100 */
            color: #0f172a;           /* slate-900 */
            font-family: -apple-system,BlinkMacSystemFont,"PingFang SC",
                "Hiragino Sans GB","Segoe UI",Roboto,system-ui,sans-serif;
            -webkit-text-size-adjust: 100%;
        }

        /* 3D Flip Styles */
        .perspective-1000 {
            perspective: 1000px;
        }

        .preserve-3d {
            transform-style: preserve-3d;
        }

        .backface-hidden {
            backface-visibility: hidden;
        }

        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        .transition-transform {
            transition-property: transform;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 500ms;
        }

        .card-inner {
            will-change: transform;
        }

        /* 自定义滚动条（答案区内容多时） */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.04);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(79, 70, 229, 0.4);
            border-radius: 4px;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-10">
        <div class="max-w-md mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3 overflow-hidden">
                <div class="bg-indigo-600 p-2 rounded-lg shrink-0">
                    <i data-lucide="book-open" class="w-5 h-5 text-white"></i>
                </div>
                <div class="flex flex-col min-w-0">
                    <span class="text-[11px] text-slate-500 tracking-wide uppercase">
                        闪卡复习 · 第一部
                    </span>
                    <h1 class="text-sm font-semibold text-slate-800 truncate">
                        《耶稣所传的福音》
                    </h1>
                </div>
            </div>

            <div id="progress-text"
                 class="text-xs font-medium text-slate-600 bg-slate-100 px-3 py-1 rounded-full shrink-0">
                1 / 17
            </div>
        </div>
    </header>

    <!-- Main -->
    <main id="app-container"
          class="flex-1 max-w-md mx-auto w-full p-4 flex flex-col justify-center items-center">
        <!-- 由 JS 注入内容 -->
    </main>

    <!-- Footer（可按需要删掉） -->
    <footer class="bg-white border-t border-slate-200 py-3">
        <div class="max-w-md mx-auto px-4 flex items-center justify-center space-x-2">
            <img src="https://img.calcgospel.top/PicList/202512/c9ba5099657621ce60b55f0cfb0e7457.png"
                 alt="微积分福音 Logo"
                 class="h-5 w-auto">
            <span class="text-[11px] text-slate-500">
                微积分福音 · 卓永鸿老师制作
            </span>
        </div>
    </footer>

    <script>
        // --- Data ---
        const initialFlashcards = [
            { id: 1, question: "根据麦卡瑟的观点，当代福音派最严重的问题是什么？", answer: "将基督的主权从福音信息中挪除，导致信仰核心受到侵蚀。" },
            { id: 2, question: "在新约中，用来描述作一个真正基督徒意义的希腊词 doulos，其确切含义是什么？", answer: "指一个最卑贱的奴隶，其主人有权迫使他服役而不必付任何薪资。" },
            { id: 3, question: "为什么耶稣会质疑那些称呼祂“主啊！主啊！”的人？(路加福音 6:46)", answer: "因为他们口头上尊敬祂，但在生活上却不遵从祂的话去行。" },
            { id: 4, question: "“一个人不能作两个主人的奴隶”为何比“一个人不能事奉两个主”更能表达原文的含义？", answer: "因为它强调的是奴隶的“身份归属”，而不仅仅是提供服务的“工作行为”。" },
            { id: 5, question: "麦卡瑟认为，将基督徒身份理解为基督的奴隶，如何对抗现代的“成功福音”？", answer: "它强调基督徒应完全降服主的旨意，而非追求个人的健康、财富或自我实现。" },
            { id: 6, question: "“只需和耶稣建立个人关系”这种说法有何潜在危险？", answer: "可能导致人们认为基督可以仅仅是密友，而非必须降服的主，从而扭曲基督徒真义。" },
            { id: 7, question: "耶稣传讲作门徒的代价时，其态度与今日许多教会领袖有何不同？", answer: "祂从不软化、掩饰或轻描淡写作门徒的代价，甚至吓跑仅是好奇或半调子的爱慕者。" },
            { id: 8, question: "在约翰福音 15:14-15 中，耶稣称门徒为朋友的条件是什么？", answer: "条件是“你们若是遵行我所吩咐的”。" },
            { id: 9, question: "耶稣说“以后我不再称你们为仆人”，这是否意味着主仆关系的结束？", answer: "否，这表示他们不仅是奴隶，更是能明白主人心意的朋友，但主仆地位并未改变。" },
            { id: 10, question: "当一个人承认耶稣是主 (Kyrios) 时，他同时也自动地承认自己是祂的什么？", answer: "奴隶 (douloi)。" },
            { id: 11, question: "在使徒行传 2:36 和罗马书 10:9 等经文中，“主”这个词不仅指耶稣的神性，更强调了什么含义？", answer: "它意味着“统治的上帝”(God who rules)，强调祂的权柄和主宰地位。" },
            { id: 12, question: "A.W. 陶恕 (A. W. Tozer) 曾说：“主不会拯救那些祂所不能______的人。”", answer: "命令" },
            { id: 13, question: "为何“救恩是一个礼物，却要付上一切代价”这个看似矛盾的说法是成立的？", answer: "救恩虽是神白白的恩赐，但领受它的信心必然包含离弃罪和降服于基督主权的代价。" },
            { id: 14, question: "耶稣在太 11:28-29 同时发出“我必使你们得安息”和“负我的轭”这两个邀请，揭示了信心的什么特质？", answer: "这揭示了因信而得的安息并非无所事事，而是包含顺服和承担责任的安息。" },
            { id: 15, question: "根据麦卡瑟的观点，圣经中的“悔改”仅仅是改变对基督身份的看法吗？", answer: "不是，它还包括承认自己的罪、从罪中转向神，并将涉及意志的改变。" },
            { id: 16, question: "真正的信心与行为之间的关系是什么？", answer: "信心与行为并非互不相容；真正的信心必然会激发产生一定程度的顺服与善行。" },
            { id: 17, question: "如果一个人的得救经历中缺乏悔改、信心、成圣、顺服等任何一个要素，这说明了什么？", answer: "这说明该经历可能不是神拯救的工作，因为神的工作不会有任何缺陷。" }
        ];

        // --- State ---
        let cards = [...initialFlashcards];
        let currentIndex = 0;
        let isFlipped = false;
        let learnedIds = [];
        let showLearned = true;

        // --- DOM Elements ---
        const appContainer = document.getElementById("app-container");
        const progressText = document.getElementById("progress-text");

        // 计算当前应显示的卡片数组
        function getActiveCards() {
            return showLearned
                ? cards
                : cards.filter(card => !learnedIds.includes(card.id));
        }

        // --- 渲染函数 ---
        function render() {
            const activeCards = getActiveCards();

            // 防越界
            if (currentIndex >= activeCards.length && activeCards.length > 0) {
                currentIndex = 0;
            }

            // 所有卡片都学完
            if (activeCards.length === 0) {
                appContainer.innerHTML = `
                    <div class="bg-white p-8 rounded-2xl shadow-lg text-center w-full">
                        <div class="flex justify-center mb-4">
                            <i data-lucide="check-circle" class="w-14 h-14 text-emerald-500"></i>
                        </div>
                        <h2 class="text-xl font-bold text-slate-800 mb-2">太棒了！</h2>
                        <p class="text-sm text-slate-600 mb-6">
                            您已经将所有卡片标记为「已学会」。
                        </p>
                        <button
                            onclick="handleShowLearned(true)"
                            class="w-full px-4 py-3 bg-indigo-600 text-white rounded-xl text-sm font-medium hover:bg-indigo-700 transition-colors">
                            重新复习所有卡片
                        </button>
                    </div>
                `;
                progressText.textContent = "0 / 0";
                lucide.createIcons();
                notifyHeight();
                return;
            }

            const currentCard = activeCards[currentIndex];
            const isLearned = learnedIds.includes(currentCard.id);

            // 更新进度显示
            progressText.textContent = `${currentIndex + 1} / ${activeCards.length}`;

            // 主体卡片 + 控制区
            appContainer.innerHTML = `
                <div class="w-full flex flex-col items-center space-y-6">

                    <!-- Flashcard -->
                    <div
                        class="w-full max-w-sm mx-auto aspect-[3/4] perspective-1000 cursor-pointer group"
                        onclick="handleFlip()"
                    >
                        <div
                            id="card-inner"
                            class="card-inner w-full h-full relative preserve-3d transition-transform rounded-2xl shadow-xl bg-transparent
                                   ${isFlipped ? "rotate-y-180" : ""}"
                        >
                            <!-- Front -->
                            <div
                                class="absolute inset-0 backface-hidden bg-white rounded-2xl border border-slate-100
                                       flex flex-col px-6 py-5"
                            >
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-[11px] font-semibold text-indigo-600 bg-indigo-50 px-2 py-1 rounded-full">
                                        问题 Question
                                    </span>
                                    ${
                                        isLearned
                                            ? '<span class="text-[11px] text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full">已学会</span>'
                                            : ""
                                    }
                                </div>

                                <div class="flex-1 flex items-center">
                                    <p class="text-base sm:text-lg leading-relaxed text-slate-800 select-none">
                                        ${currentCard.question}
                                    </p>
                                </div>

                                <div class="pt-2 flex justify-center">
                                    <p class="text-[11px] text-slate-400 flex items-center gap-1">
                                        <i data-lucide="mouse-pointer-2" class="w-3 h-3"></i>
                                        点击卡片以翻面查看答案
                                    </p>
                                </div>
                            </div>

                            <!-- Back -->
                            <div
                                class="absolute inset-0 backface-hidden rotate-y-180 rounded-2xl
                                       bg-indigo-600 text-white shadow-inner flex flex-col px-6 py-5"
                            >
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-[11px] font-semibold text-white/90 bg-white/15 px-2 py-1 rounded-full">
                                        答案 Answer
                                    </span>
                                </div>

                                <div class="flex-1 flex items-center">
                                    <div class="w-full max-h-full overflow-y-auto custom-scrollbar pr-1">
                                        <p class="text-base sm:text-lg leading-relaxed select-none">
                                            ${currentCard.answer}
                                        </p>
                                    </div>
                                </div>

                                <div class="pt-2 flex justify-center">
                                    <p class="text-[11px] text-white/70 flex items-center gap-1">
                                        <i data-lucide="mouse-pointer-2" class="w-3 h-3"></i>
                                        再次点击卡片可切换回题目
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="w-full flex flex-col items-center space-y-3">

                        <!-- 上一张 / 下一张 -->
                        <div class="flex items-center justify-center gap-4">
                            <button
                                onclick="handlePrev(event)"
                                class="p-3 rounded-full bg-white border border-slate-200 shadow-sm
                                       text-slate-700 hover:bg-slate-50 hover:text-indigo-600 hover:shadow
                                       disabled:opacity-40 disabled:cursor-not-allowed"
                                ${activeCards.length <= 1 ? "disabled" : ""}
                            >
                                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                            </button>
                            <button
                                onclick="handleNext(event)"
                                class="p-3 rounded-full bg-indigo-600 text-white shadow
                                       hover:bg-indigo-700 hover:shadow-md
                                       disabled:opacity-40 disabled:cursor-not-allowed"
                                ${activeCards.length <= 1 ? "disabled" : ""}
                            >
                                <i data-lucide="arrow-right" class="w-5 h-5"></i>
                            </button>
                        </div>

                        <!-- 标记已学会 / 洗牌 / 重置 -->
                        <div class="flex items-center justify-center flex-wrap gap-2 w-full">
                            <button
                                onclick="handleShuffle(event)"
                                title="随机排序"
                                class="p-2.5 rounded-full bg-white border border-slate-200 shadow-sm
                                       text-slate-600 hover:bg-slate-50 hover:text-indigo-600"
                            >
                                <i data-lucide="shuffle" class="w-4 h-4"></i>
                            </button>

                            <button
                                onclick="handleReset(event)"
                                title="重置顺序与学习状态"
                                class="p-2.5 rounded-full bg-white border border-slate-200 shadow-sm
                                       text-slate-600 hover:bg-slate-50 hover:text-indigo-600"
                            >
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                            </button>

                            <button
                                onclick="handleToggleLearned(event, ${currentCard.id})"
                                class="flex items-center gap-1.5 px-3.5 py-2 rounded-full border text-sm
                                       ${
                                           isLearned
                                               ? "bg-emerald-100 border-emerald-200 text-emerald-700"
                                               : "bg-white border-slate-200 text-slate-700 hover:bg-slate-50"
                                       }"
                            >
                                <i
                                    data-lucide="check-circle"
                                    class="w-4 h-4 ${
                                        isLearned
                                            ? "fill-emerald-700 text-emerald-100"
                                            : ""
                                    }"
                                ></i>
                                <span>
                                    ${isLearned ? "已学会" : "标记已学会"}
                                </span>
                            </button>
                        </div>
                    </div>

                    <!-- Filter -->
                    <div class="w-full flex items-center justify-center mt-1">
                        <label class="flex items-center gap-2 text-[12px] text-slate-500 select-none">
                            <input
                                type="checkbox"
                                ${!showLearned ? "checked" : ""}
                                onchange="handleToggleFilter(this)"
                                class="w-3.5 h-3.5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"
                            >
                            <span>隐藏已学会的卡片（${learnedIds.length}）</span>
                        </label>
                    </div>
                </div>
            `;

            lucide.createIcons();
            notifyHeight();
        }

        // --- 与 iframe 容器通讯：自动调整高度（可选） ---
        function notifyHeight() {
            try {
                if (window.parent && window.parent !== window) {
                    const height = document.documentElement.scrollHeight;
                    window.parent.postMessage(
                        { type: "jgospel-flashcards-height", height },
                        "*"
                    );
                }
            } catch (e) {
                // 忽略跨域异常
            }
        }

        // --- Event Handlers ---

        function handleFlip() {
            isFlipped = !isFlipped;
            const cardInner = document.getElementById("card-inner");
            if (!cardInner) return;
            if (isFlipped) {
                cardInner.classList.add("rotate-y-180");
            } else {
                cardInner.classList.remove("rotate-y-180");
            }
        }

        function handleNext(e) {
            if (e) e.stopPropagation();
            const activeCards = getActiveCards();
            if (activeCards.length === 0) return;
            currentIndex = (currentIndex + 1) % activeCards.length;
            isFlipped = false;
            render();
        }

        function handlePrev(e) {
            if (e) e.stopPropagation();
            const activeCards = getActiveCards();
            if (activeCards.length === 0) return;
            currentIndex = (currentIndex - 1 + activeCards.length) % activeCards.length;
            isFlipped = false;
            render();
        }

        function handleShuffle(e) {
            if (e) e.stopPropagation();
            cards.sort(() => Math.random() - 0.5);
            currentIndex = 0;
            isFlipped = false;
            render();
        }

        function handleReset(e) {
            if (e) e.stopPropagation();
            cards = [...initialFlashcards].sort((a, b) => a.id - b.id);
            currentIndex = 0;
            isFlipped = false;
            learnedIds = [];
            showLearned = true;
            render();
        }

        function handleToggleLearned(e, id) {
            if (e) e.stopPropagation();
            if (learnedIds.includes(id)) {
                learnedIds = learnedIds.filter(lId => lId !== id);
            } else {
                learnedIds.push(id);
            }
            render();
        }

        function handleToggleFilter(checkbox) {
            showLearned = !checkbox.checked;
            currentIndex = 0;
            isFlipped = false;
            render();
        }

        function handleShowLearned(show) {
            showLearned = show;
            currentIndex = 0;
            isFlipped = false;
            render();
        }

        // --- 初始化 ---
        window.addEventListener("load", () => {
            render();
        });

        window.addEventListener("resize", () => {
            notifyHeight();
        });
    </script>
</body>
</html>
